<!DOCTYPE html>
<html>
<head>
     <meta charset="UTF-8">
     <title>test pursa</title>
</head>
<body>
<input type="text" name="jib" id="jib-input">
<button type="button" onclick="makeCorsRequest()">podaciNaOsnovuJIBa</button>
<script type="text/javascript" charset="UTF-8">

// function fillFormUsingJIB(){

  // Pokupi JIB sa forme:
//   //var requestJIB = Xrm.Page.data.entity.attributes.get("zzz_jib").getValue();
//   var requestJIB = "slavisa.djukic.prointer@gmail.com";

//   console.log("Saljemo zahtjev za jib:", requestJIB);

//   //url na koji saljemo zahtjev
//   var url = "http://www.webservicex.net";
//   //var url = "http://10.2.2.2:8022/RegistarWebService.asmx?WSDL";
//   //var url = "http://10.2.2.2:8022/RegistarWebService.asmx";

//   // metod zahtjeva
//   var method = "POST";
    

//   //
//   //  TODO: probati obe verzije request package-a --- prvi salje sve podatke, drugi samo jib
//   //
//   var requestPackage = '<?xml version="1.0" encoding="utf-8"?>'+
//     '<soap12:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap12="http://www.w3.org/2003/05/soap-envelope">'+
//       '<soap12:Body>'+
//         '<IsValidEmail xmlns="http://www.webservicex.net">'+
//           '<Email>' + requestJIB + '</Email>'+
//         '</IsValidEmail>'+
//       '</soap12:Body>'+
//     '</soap12:Envelope>';



//   var xhr = new XMLHttpRequest();

//   if ("withCredentials" in xhr) {
//     // XHR for Chrome/Firefox/Opera/Safari.
//     xhr.open(method, url, true);
//   } else if (typeof XDomainRequest != "undefined") {
//     // XDomainRequest for IE.
//     xhr = new XDomainRequest();
//     xhr.open(method, url);
//   } else {
//     // CORS not supported.
//     xhr = null;
//   }

//   if (!xhr) {
//     alert('CORS not supported');
//     return;
//   }

//   xhr.onload = function() {

//     if (xhr.readyState === xhr.DONE) {
//       if (xhr.status === 200) {

//         var dataReceived = xhr.response;
 
//         console.log(dataReceived);

//         //	ocisti response od nepotrebnih elemenata - dodanih SOAPom
//         // var start = dataReceived.indexOf('<Obveznik');
//         // var end = dataReceived.indexOf('</Podaci>');
//         // dataReceived = dataReceived.substring(start, end);

//         // // ocisti preostale tagove od nepotrebnih atributa
//         // dataReceived = dataReceived.replace(/\<.*?\>/g, function(string){
//         //   if (string.indexOf(' ')>0) {
//         //     var start = string.indexOf(' ');
//         //     //console.log(start);
//         //     string = string.substring(0, start);
//         //     string += ">";
//         //   }
//         //   return string;
//         // })

//         // parser = new DOMParser();
//         // dataReceivedXML = parser.parseFromString(dataReceived,"text/xml");

//         // //
//         // // punjenje forme 
//         // //
//         // // podaci o poslodavcu
//         // //
//         // var ObveznikWrapper = dataReceivedXML.getElementsByTagName("Obveznik")[0];

//         // var ObveznikNazivObveznika =  ObveznikWrapper.getElementsByTagName("NazivObveznika")[0].childNodes[0].nodeValue;
//         // //Xrm.Page.data.entity.attributes.get("zzz_nazivposlodavca").setValue(ObveznikNazivObveznika);
//         // console.log("naziv poslodavca:",ObveznikNazivObveznika);

//         // var ObveznikStatusObveznika = ObveznikWrapper.getElementsByTagName("NazivStatusaObveznika")[0].childNodes[0].nodeValue;
//         // //Xrm.Page.data.entity.attributes.get("zzz_statusposlodavca").setValue(ObveznikStatusObveznika);
//         // console.log("status poslodavca:",ObveznikStatusObveznika);

//         // var ObveznikSifraOpstine = ObveznikWrapper.getElementsByTagName("SifraOpstine")[0].childNodes[0].nodeValue;
//         // //Xrm.Page.data.entity.attributes.get("zzz_sifraopstine").setValue(ObveznikSifraOpstine);
//         // console.log("sifra opstine poslodavca:",ObveznikSifraOpstine);

//         // var ObveznikNazivOpstine = ObveznikWrapper.getElementsByTagName("NazivOpstine")[0].childNodes[0].nodeValue;
//         // //Xrm.Page.data.entity.attributes.get("zzz_nazivopstine").setValue(ObveznikNazivOpstine);
//         // console.log("naziv opstine poslodavca:",ObveznikNazivOpstine);

//         // var ObveznikAdresaObveznika = ObveznikWrapper.getElementsByTagName("AdresaObveznika")[0].childNodes[0].nodeValue;
//         // //Xrm.Page.data.entity.attributes.get("zzz_adresa").setValue(ObveznikAdresaObveznika);
//         // console.log("adresa poslodavca:",ObveznikAdresaObveznika);

//         // var ObveznikMjestoObveznika = ObveznikWrapper.getElementsByTagName("MjestoObveznika")[0].childNodes[0].nodeValue;
//         // //Xrm.Page.data.entity.attributes.get("zzz_mjesto").setValue(ObveznikMjestoObveznika);
//         // console.log("mjesto poslodavca:",ObveznikMjestoObveznika);

//         // //
//         // //  podaci o ovlastenom licu
//         // //
//         // var OvlastenoLiceWrapper = dataReceivedXML.getElementsByTagName("OvlastenoLice")[0];

//         // var OvlastenoLiceJMBG = OvlastenoLiceWrapper.getElementsByTagName("JMBGOvlastenogLica")[0].childNodes[0].nodeValue;
//         // //Xrm.Page.data.entity.attributes.get("zzz_jmbovlastenoglica").setValue(OvlastenoLiceJMBG);
//         // console.log("ovlasteno lice - jmbg:",OvlastenoLiceJMBG);

//         // var OvlastenoLiceImePrezime = OvlastenoLiceWrapper.getElementsByTagName("OvlastenoLice")[0].childNodes[0].nodeValue;
//         // //Xrm.Page.data.entity.attributes.get("zzz_imeiprezimeovlastenoglica").setValue(OvlastenoLiceImePrezime);
//         // console.log("ovlasteno lice - ime i prezime:",OvlastenoLiceImePrezime);

//         // var OvlastenoLiceSifraOpstine = OvlastenoLiceWrapper.getElementsByTagName("SifraOpstineOvlastenogLica")[0].childNodes[0].nodeValue;
//         // //Xrm.Page.data.entity.attributes.get("zzz_sifraopstineovlastenoglica").setValue(OvlastenoLiceSifraOpstine);
//         // console.log("ovlasteno lice - sifra opstine:",OvlastenoLiceSifraOpstine);

//         // var OvlastenoLiceNazivOpstine = OvlastenoLiceWrapper.getElementsByTagName("NazivOpstineOvlastenogLica")[0].childNodes[0].nodeValue;
//         // //Xrm.Page.data.entity.attributes.get("zzz_nazivopstineovlastenoglica").setValue(OvlastenoLiceNazivOpstine);
//         // console.log("ovlasteno lice - naziv opstine:",OvlastenoLiceNazivOpstine);

//         // var OvlastenoLiceMjesto = OvlastenoLiceWrapper.getElementsByTagName("MjestoOvlastenogLica")[0].childNodes[0].nodeValue;
//         // //Xrm.Page.data.entity.attributes.get("zzz_mjestoovlastenoglica").setValue(OvlastenoLiceMjesto);
//         // console.log("ovlasteno lice - mjesto:",OvlastenoLiceMjesto);

//         // var OvlastenoLiceAdresa = OvlastenoLiceWrapper.getElementsByTagName("AdresaOvlastenoglica")[0].childNodes[0].nodeValue;
//         // //  Xrm.Page.data.entity.attributes.get("zzz_adresaovlastenoglica").setValue(OvlastenoLiceAdresa);
//         // console.log("ovlasteno lice - adresa:",OvlastenoLiceAdresa);

//         // //
//         // //  podaci o vlasniku
//         // //
//         // var VlasnikWrapper = dataReceivedXML.getElementsByTagName("Vlasnik")[0];

//         // var VlasnikJMBG = VlasnikWrapper.getElementsByTagName("JmbgJibVlasnika")[0].childNodes[0].nodeValue;
//         // //Xrm.Page.data.entity.attributes.get("zzz_jmbvlasnika").setValue(VlasnikJMBG);
//         // console.log("vlasnik - jib/jmbg:",VlasnikJMBG);

//         // var VlasnikImePrezime = VlasnikWrapper.getElementsByTagName("NazivVlasnik")[0].childNodes[0].nodeValue;
//         // //Xrm.Page.data.entity.attributes.get("zzz_imeiprezimevlasnika").setValue(VlasnikImePrezime);
//         // console.log("vlasnik - ime i prezime:",VlasnikImePrezime);

//         // var VlasnikSifraOpstine = VlasnikWrapper.getElementsByTagName("SifraOpstineVlasnika")[0].childNodes[0].nodeValue;
//         // //Xrm.Page.data.entity.attributes.get("zzz_sifraopstinevlasnika").setValue(VlasnikSifraOpstine);
//         // console.log("vlasnik - sifra opstine:",VlasnikSifraOpstine);

//         // var VlasnikNazivOpstine = VlasnikWrapper.getElementsByTagName("NazivOpstineVlasnika")[0].childNodes[0].nodeValue;
//         // //Xrm.Page.data.entity.attributes.get("zzz_nazivopstinevlasnika").setValue(vlasnikNazivOpstine);
//         // console.log("vlasnik - naziv opstine:",VlasnikNazivOpstine);

//         // var VlasnikMjesto = VlasnikWrapper.getElementsByTagName("MjestoVlasnika")[0].childNodes[0].nodeValue;
//         // //Xrm.Page.data.entity.attributes.get("zzz_mjestovlasnika").setValue(VlasnikMjesto);
//         // console.log("vlasnik - mjesto:",VlasnikMjesto);

//         // var VlasnikAdresa = VlasnikWrapper.getElementsByTagName("AdresaVlasnika")[0].childNodes[0].nodeValue;
//         // //Xrm.Page.data.entity.attributes.get("zzz_adresavlasnika").setValue(vlasnikAdresa);
//         // console.log("vlasnik - adresa:",VlasnikAdresa);

//       }
//     }

//   };

//   xhr.onerror = function() {
//     alert('Došlo je do greške tokom slanja zahtjeva.');
//   };


//   // set necessary headers in req
//   xhr.withCredentials = true;

//   //xhr.setRequestHeader("SOAPAction", "/ValidateEmail.asmx"); 
//   xhr.setRequestHeader("Content-Type", "application/soap+xml; charset=utf-8");

//   xhr.send(requestPackage);

// }


// Create the XHR object.
function createCORSRequest(method, url) {
  var xhr = new XMLHttpRequest();
  if ("withCredentials" in xhr) {
    // XHR for Chrome/Firefox/Opera/Safari.
    xhr.open(method, url, true);
  } else if (typeof XDomainRequest != "undefined") {
    // XDomainRequest for IE.
    xhr = new XDomainRequest();
    xhr.open(method, url);
  } else {
    // CORS not supported.
    xhr = null;
  }
  return xhr;
}

// Helper method to parse the title tag from the response.
function getTitle(text) {
  return text.match('<title>(.*)?</title>')[1];
}

// Make the actual CORS request.
function makeCorsRequest() {
  // This is a sample server that supports CORS.
  var url = 'http://www.webservicex.net/ValidateEmail.asmx/IsValidEmail';

  var xhr = createCORSRequest('POST', url);
  if (!xhr) {
    alert('CORS not supported');
    return;
  }

  // Response handlers.
  xhr.onload = function() {
    var text = xhr.responseText;
    var title = getTitle(text);
    alert('Response from CORS request to ' + url + ': ' + title);
  };

  xhr.onerror = function() {
    alert('Woops, there was an error making the request.');
  };

  xhr.setRequestHeader("Content-Type", "application/soap+xml; charset=utf-8");

  xhr.send("Email=string");
}


</script>

</body>
</html>